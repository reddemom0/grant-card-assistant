<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Granted AI Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-blue: #008abf;
            --secondary-gray: #6d7881;
            --light-gray: #dde1e3;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --surface-white: #ffffff;
            --background: #f8fafc;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--light-gray) 0%, #ffffff 50%, var(--light-gray) 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--light-gray);
            box-shadow: 0 4px 20px rgba(0, 138, 191, 0.08);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--primary-blue);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 138, 191, 0.25);
        }
        
        .logo-icon::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .logo-text h1 {
            font-size: 1.75rem;
            font-weight: 300;
            color: var(--secondary-gray);
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .logo-text h1 .granted {
            color: var(--primary-blue);
            font-weight: 400;
        }
        
        .logo-text p {
            font-size: 0.875rem;
            color: var(--secondary-gray);
            font-weight: 400;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-top: 0.25rem;
        }
        
        .nav-items {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--secondary-gray);
            font-size: 0.875rem;
            font-weight: 500;
            background: rgba(0, 138, 191, 0.05);
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            border: 1px solid rgba(0, 138, 191, 0.1);
        }

        .google-login-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: white;
            color: #1f1f1f;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            border: 1px solid #dadce0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .google-login-btn:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border-color: #c0c2c5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }
        
        .hero-section {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 300;
            color: var(--primary-blue);
            margin-bottom: 1rem;
            letter-spacing: -1px;
        }
        
        .hero-title .ai-hub {
            color: var(--secondary-gray);
            font-weight: 200;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--secondary-gray);
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
            font-weight: 400;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 4rem;
            margin-bottom: 4rem;
            background: rgba(255, 255, 255, 0.7);
            padding: 2rem;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--light-gray);
            box-shadow: 0 8px 32px rgba(0, 138, 191, 0.08);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--secondary-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }
        
        .agent-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2.5rem;
            border: 1px solid var(--light-gray);
            box-shadow: 0 8px 32px rgba(0, 138, 191, 0.06);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }
        
        .agent-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 20px 60px rgba(0, 138, 191, 0.15);
            border-color: rgba(0, 138, 191, 0.2);
        }
        
        .agent-card:hover::before {
            transform: scaleX(1);
        }
        
        .agent-card.grant-cards {
            --accent-color: var(--primary-blue);
        }
        
        .agent-card.etg-writer {
            --accent-color: #059669;
        }
        
        .agent-card.bcafe-writer {
            --accent-color: #2d5016;
        }
        
        .agent-card.canexport-claims {
            --accent-color: #1e3a8a;
        }
        
        .agent-card.canexport-writer {
            --accent-color: #7c3aed;
        }
        
        .agent-card.readiness-strategist {
            --accent-color: #dc2626;
        }
        
        .agent-card.internal-oracle {
            --accent-color: #ea580c;
        }
        
        .agent-header {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            margin-bottom: 2rem;
        }
        
        .agent-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: white;
            background: var(--accent-color);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        
        .agent-icon::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .agent-info h3 {
            font-size: 1.375rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        
        .agent-status {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #059669;
            background: rgba(5, 150, 105, 0.1);
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            border: 1px solid rgba(5, 150, 105, 0.2);
        }
        
        .agent-status.new {
            color: #1e3a8a;
            background: rgba(30, 58, 138, 0.1);
            border-color: rgba(30, 58, 138, 0.2);
        }
        
        .agent-status.coming-soon {
            color: #d97706;
            background: rgba(217, 119, 6, 0.1);
            border-color: rgba(217, 119, 6, 0.2);
        }
        
        .agent-description {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }
        
        .agent-features {
            list-style: none;
            margin-bottom: 2rem;
        }
        
        .agent-features li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .agent-features li::before {
            content: '✓';
            color: var(--accent-color);
            font-weight: bold;
            width: 20px;
            height: 20px;
            background: rgba(0, 138, 191, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
        }
        
        .agent-action {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: auto;
        }
        
        .agent-button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .agent-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .agent-button:disabled {
            background: var(--secondary-gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .usage-stats {
            font-size: 0.75rem;
            color: var(--secondary-gray);
            font-weight: 500;
        }
        
        .bottom-section {
            text-align: center;
            margin-top: 5rem;
            padding: 4rem;
            background: rgba(0, 138, 191, 0.03);
            border-radius: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 138, 191, 0.1);
        }
        
        .bottom-section h2 {
            color: var(--primary-blue);
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 1.5rem;
            letter-spacing: -0.5px;
        }
        
        .bottom-section p {
            color: var(--secondary-gray);
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
            font-size: 1.05rem;
        }
        
        .cta-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .cta-button {
            background: rgba(0, 138, 191, 0.1);
            color: var(--primary-blue);
            border: 2px solid rgba(0, 138, 191, 0.2);
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .cta-button:hover {
            background: rgba(0, 138, 191, 0.15);
            border-color: rgba(0, 138, 191, 0.3);
            transform: translateY(-2px);
        }
        
        .cta-button.primary {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .cta-button.primary:hover {
            background: #007aa8;
            border-color: #007aa8;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            background: #059669;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .stats-bar {
                gap: 2rem;
                padding: 1.5rem;
            }
            
            .agents-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .agent-card {
                padding: 2rem;
            }
            
            .container {
                padding: 2rem 1rem;
            }
            
            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .logo-text h1 {
                font-size: 1.5rem;
            }
        }
        
        /* Subtle animations */
        .agent-card {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .agent-card:nth-child(2) { animation-delay: 0.1s; }
        .agent-card:nth-child(3) { animation-delay: 0.2s; }
        .agent-card:nth-child(4) { animation-delay: 0.3s; }
        .agent-card:nth-child(5) { animation-delay: 0.4s; }
        .agent-card:nth-child(6) { animation-delay: 0.5s; }
        .agent-card:nth-child(7) { animation-delay: 0.6s; }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">G</div>
                <div class="logo-text">
                    <h1><span class="granted">Granted</span> AI Hub</h1>
                    <p>Consulting</p>
                </div>
            </div>
            <div class="nav-items">
                <div class="user-info" id="user-info">
                    <img id="user-picture" src="" alt="User" style="width: 32px; height: 32px; border-radius: 50%; display: none;">
                    <span id="user-name">Loading...</span>
                    <span>•</span>
                    <button onclick="logout()" style="background: none; border: none; color: var(--secondary-gray); cursor: pointer; font-weight: 500; font-size: 0.875rem;">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">AI Team <span class="ai-hub">Dashboard</span></h1>
            <p class="hero-subtitle" id="hero-subtitle">
                Select an AI specialist below to get started. Each agent has access to our complete knowledge base
                and follows our proven workflows. Upload documents, ask questions, and get professional outputs ready for client delivery.
            </p>

            <div class="stats-bar" id="stats-bar">
                <div class="stat-item">
                    <div class="stat-number">5</div>
                    <div class="stat-label">Team Members Online</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">127</div>
                    <div class="stat-label">Grants Processed This Month</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">68</div>
                    <div class="stat-label">AI Tasks Completed This Week</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">Claims</div>
                    <div class="stat-label">Newest Agent</div>
                </div>
            </div>
        </div>

        <!-- AI Agents Grid -->
        <div class="agents-grid" id="agents-grid">
            <!-- Grant Card Assistant -->
            <div class="agent-card grant-cards" onclick="openAgent('grant-cards')">
                <div class="agent-header">
                    <div class="agent-icon">📄</div>
                    <div class="agent-info">
                        <h3>Grant Card Assistant</h3>
                        <span class="agent-status">
                            <div class="status-indicator"></div>
                            Active
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Transform raw grant documents into structured Grant Cards using your proprietary workflows. 
                    Includes preview generation, requirements extraction, insights, and categorization.
                </p>
                <ul class="agent-features">
                    <li>Generate Grant Criteria from documents</li>
                    <li>Create preview descriptions & requirements</li>
                    <li>Extract strategic insights & competitive intelligence</li>
                    <li>Add categories and tags for organization</li>
                    <li>Identify missing information gaps</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button">
                        <span>Open Assistant</span>
                        <span>→</span>
                    </button>
                    <div class="usage-stats">247 cards created</div>
                </div>
            </div>

            <!-- CanExport Claims Assistant -->
            <div class="agent-card canexport-claims" onclick="openAgent('canexport-claims')">
                <div class="agent-header">
                    <div class="agent-icon">💰</div>
                    <div class="agent-info">
                        <h3>CanExport Claims Assistant</h3>
                        <span class="agent-status new">
                            <div style="width: 8px; height: 8px; background: #1e3a8a; border-radius: 50%;"></div>
                            New
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Professional CanExport SME claims auditing specialist. Verifies invoices, proof of payments, 
                    and documentation compliance across all 8 expense categories per official guidelines.
                </p>
                <ul class="agent-features">
                    <li>Invoice & proof of payment verification</li>
                    <li>All 8 CanExport SME categories (A-H)</li>
                    <li>Currency conversion & Bank of Canada rates</li>
                    <li>Arms-length transaction verification</li>
                    <li>File naming convention compliance</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button">
                        <span>Open Claims Auditor</span>
                        <span>→</span>
                    </button>
                    <div class="usage-stats">Newly launched</div>
                </div>
            </div>

            <!-- ETG Writing Agent -->
            <div class="agent-card etg-writer" onclick="openAgent('etg-writer')">
                <div class="agent-header">
                    <div class="agent-icon">📝</div>
                    <div class="agent-info">
                        <h3>ETG Business Case Specialist</h3>
                        <span class="agent-status">
                            <div class="status-indicator"></div>
                            Active
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Specialized BC Employee Training Grant specialist that writes compelling, submission-ready business cases. 
                    Handles eligibility verification, compliance checking, and complete application drafting.
                </p>
                <ul class="agent-features">
                    <li>ETG eligibility verification & compliance</li>
                    <li>Submission-ready business case writing</li>
                    <li>Training provider research & validation</li>
                    <li>Budget optimization & cost analysis</li>
                    <li>ROI calculations & impact projections</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button">
                        <span>Open Specialist</span>
                        <span>→</span>
                    </button>
                    <div class="usage-stats">89 cases written</div>
                </div>
            </div>

            <!-- BC Agriculture Export Agent -->
            <div class="agent-card bcafe-writer" onclick="openAgent('bcafe-writer')">
                <div class="agent-header">
                    <div class="agent-icon">🌾</div>
                    <div class="agent-info">
                        <h3>BC Agriculture Export Specialist</h3>
                        <span class="agent-status">
                            <div class="status-indicator"></div>
                            Active
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Expert BC Agriculture and Food Export Program specialist. Creates submission-ready 
                    applications using merit-based competitive strategies and complete compliance verification.
                </p>
                <ul class="agent-features">
                    <li>BCAFE eligibility verification & funding calculation</li>
                    <li>Merit-optimized application writing (5 evaluation criteria)</li>
                    <li>Export market development strategy</li>
                    <li>Budget optimization with quote management</li>
                    <li>Activity selection for competitive advantage</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button">
                        <span>Open Specialist</span>
                        <span>→</span>
                    </button>
                    <div class="usage-stats">Active agent</div>
                </div>
            </div>

            <!-- CanExport Writing Assistant -->
            <div class="agent-card canexport-writer" onclick="openAgent('canexport-writer')">
                <div class="agent-header">
                    <div class="agent-icon">🌍</div>
                    <div class="agent-info">
                        <h3>CanExport Writing Assistant</h3>
                        <span class="agent-status coming-soon">
                            <div style="width: 8px; height: 8px; background: #d97706; border-radius: 50%;"></div>
                            Coming Soon
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Expert CanExport SME grant writer helping Canadian enterprises secure maximum funding. 
                    Collaborates with Grant Strategists to achieve the 36% approval rate benchmark.
                </p>
                <ul class="agent-features">
                    <li>CanExport SME application drafting</li>
                    <li>Market entry strategy development</li>
                    <li>Export readiness assessment</li>
                    <li>Budget planning & optimization</li>
                    <li>Compliance verification & review</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button" disabled>
                        <span>Coming Soon</span>
                        <span>⏳</span>
                    </button>
                    <div class="usage-stats">In development</div>
                </div>
            </div>

            <!-- Applicant Readiness Strategist -->
            <div class="agent-card readiness-strategist" onclick="openAgent('readiness-strategist')">
                <div class="agent-header">
                    <div class="agent-icon">🎯</div>
                    <div class="agent-info">
                        <h3>Readiness Strategist</h3>
                        <span class="agent-status coming-soon">
                            <div style="width: 8px; height: 8px; background: #d97706; border-radius: 50%;"></div>
                            Coming Soon
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Conducts comprehensive readiness assessments to determine client preparedness for specific grants. 
                    Provides interview questions, research, and scored readiness reports for strategy teams.
                </p>
                <ul class="agent-features">
                    <li>Grant-specific readiness interviews</li>
                    <li>Company assessment & scoring</li>
                    <li>Gap analysis & recommendations</li>
                    <li>Timeline planning & milestones</li>
                    <li>Strategic positioning advice</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button" disabled>
                        <span>Coming Soon</span>
                        <span>⏳</span>
                    </button>
                    <div class="usage-stats">In development</div>
                </div>
            </div>

            <!-- Granted Internal Oracle -->
            <div class="agent-card internal-oracle" onclick="openAgent('internal-oracle')">
                <div class="agent-header">
                    <div class="agent-icon">🔮</div>
                    <div class="agent-info">
                        <h3>Internal Knowledge Oracle</h3>
                        <span class="agent-status coming-soon">
                            <div style="width: 8px; height: 8px; background: #d97706; border-radius: 50%;"></div>
                            Coming Soon
                        </span>
                    </div>
                </div>
                <p class="agent-description">
                    Your comprehensive Granted Consulting knowledge expert. Trained on all company data, processes, 
                    client history, and internal documentation. Answers any staff query with institutional wisdom.
                </p>
                <ul class="agent-features">
                    <li>Company policies & procedures lookup</li>
                    <li>Client history & case studies</li>
                    <li>Internal process guidance</li>
                    <li>Best practices & methodology</li>
                    <li>Team resources & documentation</li>
                </ul>
                <div class="agent-action">
                    <button class="agent-button" disabled>
                        <span>Coming Soon</span>
                        <span>⏳</span>
                    </button>
                    <div class="usage-stats">In development</div>
                </div>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="bottom-section" id="bottom-section">
            <h2>Ready to Transform Your Workflow?</h2>
            <p>
                Each AI agent is trained on your proprietary knowledge base and industry best practices. 
                Start with the Grant Card Assistant or try our newest CanExport Claims auditing specialist.
            </p>
            <div class="cta-buttons">
                <a href="#" class="cta-button primary" onclick="openAgent('grant-cards')">
                    Start with Grant Cards
                </a>
                <a href="#" class="cta-button" onclick="openAgent('canexport-claims')">
                    Try Claims Assistant
                </a>
                <a href="#" class="cta-button" onclick="openAgent('bcafe-writer')">
                    BC Agriculture Export
                </a>
                <a href="#" class="cta-button" onclick="openAgent('etg-writer')">
                    ETG Specialist
                </a>
            </div>
        </div>
    </div>

    <script>
        // Check authentication on page load
        function checkAuth() {
            const cookies = document.cookie.split(';');
            const authToken = cookies.find(c => c.trim().startsWith('auth_token='));

            if (!authToken) {
                // User not authenticated, redirect to login
                console.log('No auth token, redirecting to login...');
                window.location.href = '/';
                return false;
            }

            // User is authenticated
            console.log('✅ User authenticated');
            return true;
        }

        // Get user info from JWT (decode without verification - backend already validated)
        function getUserInfo() {
            const cookies = document.cookie.split(';');
            const authCookie = cookies.find(c => c.trim().startsWith('auth_token='));

            if (!authCookie) return null;

            const token = authCookie.split('=')[1];
            try {
                // JWT has 3 parts separated by dots
                const payload = token.split('.')[1];
                // Decode base64
                const decoded = JSON.parse(atob(payload));
                return decoded;
            } catch (e) {
                console.error('Failed to decode token:', e);
                return null;
            }
        }

        // Logout function
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
            } catch (e) {
                console.error('Logout request failed:', e);
            }
            // Clear cookie and redirect
            document.cookie = 'auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
            window.location.href = '/';
        }

        function openAgent(agentType) {
            const agentMap = {
                'grant-cards': {
                    url: '/grant-cards',
                    active: true
                },
                'canexport-claims': {
                    url: '/canexport-claims.html',
                    active: true
                },
                'etg-writer': {
                    url: '/etg-writer',
                    active: true
                },
                'bcafe-writer': {
                    url: '/bcafe-writer',
                    active: true
                },
                'canexport-writer': {
                    url: '/canexport-writer', 
                    active: false
                },
                'readiness-strategist': {
                    url: '/readiness-strategist',
                    active: false
                },
                'internal-oracle': {
                    url: '/internal-oracle',
                    active: false
                }
            };
            
            const agent = agentMap[agentType];
            if (agent && agent.active) {
                window.location.href = agent.url;
            } else {
                alert(`The ${agentType.replace('-', ' ')} agent is coming soon! \n\nWe're working on expanding our AI specialist team.`);
            }
        }

        function showAnalytics() {
            alert('Performance Analytics Dashboard coming soon! \n\nTrack usage metrics, efficiency gains, and ROI across all your AI specialists.');
        }

        // Add smooth scroll-triggered animations
        document.addEventListener('DOMContentLoaded', function() {
            // Run auth check when page loads
            if (!checkAuth()) {
                return; // Redirect will happen
            }

            // Get and display user info
            const userInfo = getUserInfo();
            if (userInfo) {
                const userName = document.getElementById('user-name');
                const userPicture = document.getElementById('user-picture');

                if (userName) {
                    userName.textContent = userInfo.name || userInfo.email;
                }

                if (userPicture && userInfo.picture) {
                    userPicture.src = userInfo.picture;
                    userPicture.style.display = 'block';
                }
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationPlayState = 'running';
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.agent-card').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>
