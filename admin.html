<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Granted AI Hub</title>
  <link rel="stylesheet" href="/public/css/admin.css">
  <link rel="icon" type="image/svg+xml" href="/public/images/granted-logo.svg">
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="/images/granted-logo.svg" alt="Granted" class="sidebar-logo">
        <h1>Admin Dashboard</h1>
      </div>

      <nav class="sidebar-nav">
        <a href="#overview" class="nav-item active" data-section="overview">
          <span class="icon">üìä</span>
          <span>Overview</span>
        </a>
        <a href="#users" class="nav-item" data-section="users">
          <span class="icon">üë•</span>
          <span>Users</span>
        </a>
        <a href="#conversations" class="nav-item" data-section="conversations">
          <span class="icon">üí¨</span>
          <span>Conversations</span>
        </a>
        <a href="#analytics" class="nav-item" data-section="analytics">
          <span class="icon">üìà</span>
          <span>Analytics</span>
        </a>
        <a href="#errors" class="nav-item" data-section="errors">
          <span class="icon">‚ö†Ô∏è</span>
          <span>Errors</span>
        </a>
        <a href="#system" class="nav-item" data-section="system">
          <span class="icon">‚öôÔ∏è</span>
          <span>System Health</span>
        </a>
        <a href="#audit" class="nav-item" data-section="audit">
          <span class="icon">üìù</span>
          <span>Audit Log</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <img id="userAvatar" src="" alt="User" class="user-avatar">
          <div class="user-details">
            <div id="userName" class="user-name">Loading...</div>
            <div class="user-role">Admin</div>
          </div>
        </div>
        <a href="/dashboard" class="btn-secondary btn-small">Back to Dashboard</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <h2 id="sectionTitle">Overview</h2>
        <div class="header-actions">
          <button id="refreshBtn" class="btn-icon" title="Refresh">üîÑ</button>
        </div>
      </header>

      <div class="content-body">
        <!-- Overview Section -->
        <section id="overview-section" class="dashboard-section active">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üë•</div>
              <div class="stat-content">
                <div class="stat-label">Total Users</div>
                <div class="stat-value" id="totalUsers">-</div>
                <div class="stat-meta"><span id="activeUsers">-</span> active (7 days)</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">üí¨</div>
              <div class="stat-content">
                <div class="stat-label">Total Conversations</div>
                <div class="stat-value" id="totalConversations">-</div>
                <div class="stat-meta"><span id="todayConversations">-</span> today</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">‚ö†Ô∏è</div>
              <div class="stat-content">
                <div class="stat-label">Errors (24h)</div>
                <div class="stat-value" id="errorCount">-</div>
                <div class="stat-meta">System errors</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-content">
                <div class="stat-label">Tokens (30d)</div>
                <div class="stat-value" id="totalTokens">-</div>
                <div class="stat-meta">API usage</div>
              </div>
            </div>
          </div>

          <div class="dashboard-grid">
            <div class="dashboard-card">
              <h3>Agent Usage (30 days)</h3>
              <div id="agentUsageList" class="agent-usage-list">
                <div class="loading">Loading agent usage...</div>
              </div>
            </div>

            <div class="dashboard-card">
              <h3>Recent Activity</h3>
              <div id="recentActivityList" class="activity-list">
                <div class="loading">Loading recent activity...</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Users Section -->
        <section id="users-section" class="dashboard-section">
          <div class="section-toolbar">
            <div class="search-box">
              <input type="text" id="userSearch" placeholder="Search users...">
            </div>
            <div class="filters">
              <select id="roleFilter">
                <option value="">All Roles</option>
                <option value="admin">Admin</option>
                <option value="user">User</option>
                <option value="client">Client</option>
                <option value="guest">Guest</option>
              </select>
              <select id="activeFilter">
                <option value="">All Users</option>
                <option value="true">Active Only</option>
                <option value="false">Inactive Only</option>
              </select>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="usersTable">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Conversations</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr>
                  <td colspan="7" class="loading">Loading users...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" id="usersPagination"></div>
        </section>

        <!-- Conversations Section -->
        <section id="conversations-section" class="dashboard-section">
          <div class="section-toolbar">
            <div class="search-box">
              <input type="text" id="conversationSearch" placeholder="Search conversations...">
            </div>
            <div class="filters">
              <select id="agentTypeFilter">
                <option value="">All Agents</option>
              </select>
              <input type="date" id="startDateFilter" placeholder="Start Date">
              <input type="date" id="endDateFilter" placeholder="End Date">
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="conversationsTable">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Agent</th>
                  <th>Title</th>
                  <th>Messages</th>
                  <th>Tokens</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="conversationsTableBody">
                <tr>
                  <td colspan="7" class="loading">Loading conversations...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" id="conversationsPagination"></div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="dashboard-section">
          <div class="dashboard-grid">
            <div class="dashboard-card full-width">
              <h3>Usage Trends (7 days)</h3>
              <canvas id="usageTrendsChart"></canvas>
            </div>

            <div class="dashboard-card">
              <h3>Cost Estimates (30 days)</h3>
              <div id="costEstimates" class="cost-estimates">
                <div class="loading">Loading cost data...</div>
              </div>
            </div>

            <div class="dashboard-card">
              <h3>Top Users (30 days)</h3>
              <div id="topUsersList" class="top-users-list">
                <div class="loading">Loading top users...</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Errors Section -->
        <section id="errors-section" class="dashboard-section">
          <div class="section-toolbar">
            <div class="filters">
              <select id="errorTypeFilter">
                <option value="">All Error Types</option>
              </select>
              <select id="errorAgentFilter">
                <option value="">All Agents</option>
              </select>
              <select id="errorTimeFilter">
                <option value="24">Last 24 Hours</option>
                <option value="168">Last 7 Days</option>
                <option value="720">Last 30 Days</option>
              </select>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="errorsTable">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>User</th>
                  <th>Agent</th>
                  <th>Type</th>
                  <th>Message</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="errorsTableBody">
                <tr>
                  <td colspan="6" class="loading">Loading errors...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- System Health Section -->
        <section id="system-section" class="dashboard-section">
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <h3>System Status</h3>
              <div id="systemHealth" class="system-health">
                <div class="loading">Loading system health...</div>
              </div>
            </div>

            <div class="dashboard-card">
              <h3>Database Statistics</h3>
              <div id="databaseStats" class="database-stats">
                <div class="loading">Loading database stats...</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Audit Log Section -->
        <section id="audit-section" class="dashboard-section">
          <div class="section-toolbar">
            <div class="filters">
              <select id="auditActionFilter">
                <option value="">All Actions</option>
                <option value="user_updated">User Updated</option>
                <option value="conversation_deleted">Conversation Deleted</option>
                <option value="conversation_viewed">Conversation Viewed</option>
              </select>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="auditTable">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Admin</th>
                  <th>Action</th>
                  <th>Target</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody id="auditTableBody">
                <tr>
                  <td colspan="5" class="loading">Loading audit log...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" id="auditPagination"></div>
        </section>
      </div>
    </main>
  </div>

  <!-- Modals -->
  <div id="conversationModal" class="modal">
    <div class="modal-content large">
      <div class="modal-header">
        <h3>Conversation Details</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="conversationModalBody">
        <div class="loading">Loading conversation...</div>
      </div>
    </div>
  </div>

  <div id="errorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Error Details</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="errorModalBody">
        <div class="loading">Loading error...</div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script src="/public/js/admin.js"></script>
</body>
</html>
